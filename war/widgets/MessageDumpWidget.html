<html>
<head>
  <title>message dump widget </title>

  <!-- Load the OpenAjax Hub. This example uses the "release/all" configuration -->
  <script src="pagebus.js"></script>
  <script type="text/javascript">
    function client3SecurityAlertHandler(source, alertType) {
      // Handle security alerts
    }

    /* Callback that is invoked upon successful connection to the Managed Hub */
    function connectCompleted ( hubClient, success, error ) {
      if (success) {
        /* Call hubClient.publish(...) to publish messages  */
        hubClient.subscribe('**', onIncomingMessage);
      }
    }
    
    function onIncomingMessage(topic, publisherData, subscriberData) {
//      document.getElementById('messageDumpArea').innerHTML += dump(publisherData);
//        console.log(publisherData);
    }

  function dump(arr,level) {
    var dumped_text = "";
    if(!level) level = 0;

    //The padding given at the beginning of the line.
    var level_padding = "";
    for(var j=0;j<level+1;j++) level_padding += "    ";

    if(typeof(arr) == 'object') { //Array/Hashes/Objects
      for(var item in arr) {
        var value = arr[item];

        if(typeof(value) == 'object') { //If it is an array,
          dumped_text += level_padding + "'" + item + "' ...\n";
          dumped_text += dump(value,level+1);
        } else {
          dumped_text += level_padding + "'" + item + "' => \"" + value + "\"\n";
        }
      }
    } else { //Stings/Chars/Numbers etc.
      dumped_text = "===>"+arr+"<===("+typeof(arr)+")";
    }
    return dumped_text;
  }

    /* Application initializes in response to document load event */
    function loadEventHandler() {
      hubClient = new OpenAjax.hub.IframeHubClient({
        HubClient: {
          onSecurityAlert: client3SecurityAlertHandler
        }
      });

      // Connect to the ManagedHub
      hubClient.connect( connectCompleted );
    }
  </script>
</head>
<body onload="loadEventHandler();">
  <div style="border:black;height:400px;">
    <h3>MessageDumper</h3>
	<p>
    <textarea id="messageDumpArea" rows="20"></textarea>
	</p>
  </div>
</body>
</html>